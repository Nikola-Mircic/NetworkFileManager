<!DOCTYPE html>
<html>
<head>
	<title>Network file manager</title>

	<link rel="stylesheet" type="text/css" href="./assets/css/main.css">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, target-densityDpi=device-dpi">
	<script type="text/javascript" src="/socket.io/socket.io.js"></script>
	<script type="text/javascript" src="./assets/js/jquery.min.js"></script>
	<script type="text/javascript" src="./assets/js/jszip.min.js"></script>
	<script type="text/javascript" src="./assets/js/FileSaver.min.js"></script>
	
	<script>
		const socket = io();
	</script>

	<script id="pageScript" type="text/javascript" src="./assets/js/main.js"></script>
</head>
<body>
	<div id="header">
		<div id="headerContainer" class="headerContainer">
			<h1 id="headerText">Network file manager</h1>
		</div>
		<div id="userIpAddr" class="headerContainer" style="display: none;">
			<h6>Your IPv4: <span id="ipv4">192.168.1.9</span></h6>
		</div>
		<form id="register" class="profileField">
			<input type="text" name="userName" id="userName" placeholder=" Enter your name / ID">
			<button onclick="registerUser();">Register</button>
		</form>

		<div id="profile" class="profileField" style="display: none;">
			<h3 name="profileName" id="profileName"></h3>
			<button onclick="changeUser();">Change</button>
		</div>
	</div>
	<nav class="nav">
		<li><a onclick="redirect('/');"><button><i class="fa-regular fa-pen-to-square"></i> Workspace</button></a></li>
		<li><a onclick="redirect('/sent');"><button><i class="fa-solid fa-paper-plane"></i> Send</button></a></li>
		<li><a onclick="redirect('/history');"><button active><i class="fa-solid fa-clock-rotate-left"></i> History</button></a></li>
	</nav>

	<section id="history">

	</section>

	<script>
		function print(data){
			document.getElementById("history").innerHTML = data;
		}
		
		fetch(window.location+"get-history")
			.then((data)=>data.body)
			.then((data)=>{
				data.getReader().read().then(({done,value})=>{
					value = new TextDecoder().decode(value);
					console.log(value);
					console.log(JSON.parse(value));
					print(value);
				})
			});

		(function(){
			var head = document.getElementsByTagName("head")[0];
			var link = document.createElement("link");
			link.setAttribute("rel", "stylesheet");
			link.setAttribute("type", "text/css");
			link.setAttribute("href", "./assets/css/history.css");
			link.setAttribute("name", "css");

			document.getElementsByName("css").forEach((node)=>node.remove());

			head.append(link);

			updateUser(window.sessionStorage.getItem("username"));
		})();
	</script>

	<!-- PAGE SPECIFIC SCRIPTS-->
</body>
</html>